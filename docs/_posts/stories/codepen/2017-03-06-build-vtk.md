---
layout: post
title:  "build vtk"
tags: codepen
categories: codepen
---

* TOC
{:toc}


------

参考方法

```
https://zhangxc.com/2015/02/qt5-mingw-cmake-vtk6
```

### 1 安装 mingw-w64

qt 安装以后默认有 desktop qt 5.7.1 mingw 32 bit 的编译器，但 cmake 选择 mingw makefiles 时提示错误。

<!-- ![error](/images/codepen/img/cmake/1.jpg) -->

```
http://mingw-w64.org/doku.php/download
```

下载地址
```
https://sourceforge.net/projects/mingw/?source=typ_redirect
```

<!-- ![error](/images/codepen/img/cmake/2.jpg) -->

慢慢等待下载，安装了所有 basic setup，要花点时间

<!-- ![error](/images/codepen/img/cmake/3.jpg) -->

### 2 configure

重新打开 cmake，然后开始 configure，很多 -- not found ，不知道会不会有影响。

<!-- ![error](/images/codepen/img/cmake/5.jpg) -->

```
[ 39%] Building C object ThirdParty/tiff/vtktiff/libtiff/CMakeFiles/vtktiff.dir/tif_aux.c.obj
In file included from D:/Qt/Qt5.7.1/Tools/mingw530_32/i686-w64-mingw32/include/io.h:169:0,
                 from D:/Qt/Qt5.7.1/Tools/mingw530_32/i686-w64-mingw32/include/fcntl.h:8,
                 from E:\VTK-7.1.0\vtksrc\ThirdParty\tiff\vtktiff\libtiff\tiffiop.h:36,
                 from E:\VTK-7.1.0\vtksrc\ThirdParty\tiff\vtktiff\libtiff\tif_aux.c:32:
D:/Qt/Qt5.7.1/Tools/mingw530_32/i686-w64-mingw32/include/_mingw_off_t.h:23:55: error: operator '==' has no left operand
 #if (defined(_FILE_OFFSET_BITS) && (_FILE_OFFSET_BITS == 64))
                                                       ^
In file included from D:/Qt/Qt5.7.1/Tools/mingw530_32/i686-w64-mingw32/include/fcntl.h:8:0,
                 from E:\VTK-7.1.0\vtksrc\ThirdParty\tiff\vtktiff\libtiff\tiffiop.h:36,
                 from E:\VTK-7.1.0\vtksrc\ThirdParty\tiff\vtktiff\libtiff\tif_aux.c:32:
D:/Qt/Qt5.7.1/Tools/mingw530_32/i686-w64-mingw32/include/io.h:340:55: error: operator '==' has no left operand
 #if (defined(_FILE_OFFSET_BITS) && (_FILE_OFFSET_BITS == 64))
                                                       ^
In file included from E:\VTK-7.1.0\vtksrc\ThirdParty\tiff\vtktiff\libtiff\tiffio.h:258:0,
                 from E:\VTK-7.1.0\vtksrc\ThirdParty\tiff\vtktiff\libtiff\tiffiop.h:66,
                 from E:\VTK-7.1.0\vtksrc\ThirdParty\tiff\vtktiff\libtiff\tif_aux.c:32:
D:/Qt/Qt5.7.1/Tools/mingw530_32/i686-w64-mingw32/include/stdio.h:467:55: error:
operator '==' has no left operand
 #if (defined(_FILE_OFFSET_BITS) && (_FILE_OFFSET_BITS == 64))
                                                       ^
D:/Qt/Qt5.7.1/Tools/mingw530_32/i686-w64-mingw32/include/stdio.h:479:55: error:operator '==' has no left operand
 #if (defined(_FILE_OFFSET_BITS) && (_FILE_OFFSET_BITS == 64))
                                                       ^
ThirdParty\tiff\vtktiff\libtiff\CMakeFiles\vtktiff.dir\build.make:62: recipe for target 'ThirdParty/tiff/vtktiff/libtiff/CMakeFiles/vtktiff.dir/tif_aux.c.obj' failed
mingw32-make[2]: *** [ThirdParty/tiff/vtktiff/libtiff/CMakeFiles/vtktiff.dir/tif_aux.c.obj] Error 1
CMakeFiles\Makefile2:2478: recipe for target 'ThirdParty/tiff/vtktiff/libtiff/CMakeFiles/vtktiff.dir/all' failed
mingw32-make[1]: *** [ThirdParty/tiff/vtktiff/libtiff/CMakeFiles/vtktiff.dir/all] Error 2
Makefile:128: recipe for target 'all' failed
mingw32-make: *** [all] Error 2
```

2017 05 02

重新下载了 vtk 6.3.0

这次make 和 generator 都比较顺利，可能是版本问题， vtk 7.1.0 to vs2010 总是错误连连。

一点半了，编译需要的计算能力要求还是蛮高，估计两个小时都搞不定，先睡觉了。

![monitor](/images/codepen/monitor.jpg)

![well done](/images/codepen/well-done.jpg)


```
116>已用时间 00:00:01.72
117>------ 已启动生成: 项目: ALL_BUILD, 配置: Release x64 ------
117>生成启动时间为 2017/5/2 1:32:53。
117>InitializeBuildStatus:
117>  正在创建“x64\Release\ALL_BUILD\ALL_BUILD.unsuccessfulbuild”，因为已指定“AlwaysCreate”。
117>CustomBuild:
117>  Building Custom Rule E:/vtk/VTK-6.3.0/CMakeLists.txt
117>  CMake does not need to re-run because E:/vtk/VTK-build/CMakeFiles/generate.stamp is up-to-date.
117>FinalizeBuildStatus:
117>  正在删除文件“x64\Release\ALL_BUILD\ALL_BUILD.unsuccessfulbuild”。
117>  正在对“x64\Release\ALL_BUILD\ALL_BUILD.lastbuildstate”执行 Touch 任务。
117>
117>生成成功。
117>
117>已用时间 00:00:00.55
========== 生成: 成功 117 个，失败 0 个，最新 0 个，跳过 0 个 ==========
```

cmake -DVTK_DIR:PATH=E:\vtk\VTK-build ..

好像是忘记了添加 QT ，那我们再来一遍吧 

```

8>InitializeBuildStatus:
8>  正在对“QVTKWidgetPlugin.dir\Release\QVTKWidgetPlugin.unsuccessfulbuild”执行 Touch 任务。
8>CustomBuild:
8>  所有输出均为最新。
8>ClCompile:
8>  所有输出均为最新。
8>Qt5Widgets.lib(Qt5Widgets.dll) : fatal error LNK1112: 模块计算机类型“X86”与目标计算机类型“x64”冲突
8>
8>生成失败。
8>
8>已用时间 00:00:00.25
========== 生成: 成功 1 个，失败 7 个，最新 116 个，跳过 0 个 ==========
```

我服，还要再编译一个QT 64位……